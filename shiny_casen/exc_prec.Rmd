---
title: "exc_prec"
author: "Victor"
date: "26 de noviembre de 2020"
output: html_document
---
```{r , message=FALSE, warning=FALSE}

suppressWarnings(library(RODBC))

library(ggplot2)
library(ggpubr)
library(markdown)
library(shiny)
library(shinythemes)
library(tidyverse)
library(magrittr)
library(lubridate)
library(plotly)
library(xts)
library(dygraphs)
library(kableExtra)
library(knitr)
library("readxl")
library(rsconnect)
library(dplyr)
library(summarytools)
library(epiDisplay)
#library(leaflet)
library(haven)
library(epiDisplay)
library("readxl")
library(expss)
library(hrbrthemes)
library(viridis)
library(viridisLite)
library(DescTools)
library(roperators)
library(shinycssloaders)
library(writexl)
library(labelled)
library(tidyverse)
library(haven)
library(readr)
library(sjmisc)
library(WriteXLS)

```

```{r , echo=FALSE, cache=FALSE, results=FALSE, warning=FALSE, comment=FALSE, warning=FALSE}


dataset06 <- read.dta('casen2006.dta')


```

```{r}
nrow(dataset06)
```


```{r}
#dataset2006_sub <- dataset06[1:100000,]
dataset2006_sub <- dataset06
#write.csv(dataset2006_sub,"mydata2006_sub.csv", row.names = FALSE)

save(dataset2006_sub, file = "dataset2006_sub.rda")


```
```{r}
da2006 <- readRDS('dataset2006_sub.rda')
```

```{r}
dataset2006 <- read_sav('casen2006.sav')

```


```{r}
w <- dataset2006[[6]] %>% attr('labels')
# head(w,4)
# #### Aqui se obtienen los nombres de las comunas
# a <- names(w) 
# head(a,4)
# b<-w[[4]]
# b
# # head(a,5)
#length(a)
```
```{r}
#length(a)
```
```{r}

dataset06 <- read.csv('mydata2006_sub.csv')
colnames(dataset06)
```

```{r}
#dataset06 <- read.csv('mydata2006_sub.csv')

        a <- dataset06$comuna
        b <- dataset06$t4
        c <- dataset06$e1
        d <- dataset06$sexo
        cross_tab= table(a, b, c, d)
       # cross_tab
      tabla <- as.data.frame(cross_tab)
      tabla
      #write.csv(datallll,"muestra_m_Patricio_2006.csv", row.names = FALSE)
      
```

```{r}
# tabla <- as.data.frame(cross_tab)
# #head(tabla,10)
# head(tabla,10)
```

```{r}
d <-tabla[!(tabla$Freq == 0),]

datallll <- data.frame()

 for(i in 1: nrow(d)){
   llll_fila <- d[i,]
    llll<-d[i,1]
    sentenceString <- toString(llll)
            searchString <- ' '
            replacementString <- ''
            sentenceString = sub(searchString,replacementString,sentenceString)
            sentenceString

             w <- dataset2006[[6]] %>% attr('labels')
             for(j in 1: 336){


               ww<-names(w[j])
              vv<-tolower(ww)

               if(sentenceString==vv){
                 llll_fila <- cbind(llll_fila,w[[j]])
                 llll_fila <- cbind(llll_fila,"2006")
                 datallll <-rbind(datallll,llll_fila)
               }
              }
  }

```

```{r}
datallll
write.csv(datallll,"muestra_Patricio_2006.csv", row.names = FALSE)
```

33 desde aqui para abajo todo se puede eliminar


```{r}
ppp <- data_frame()

      
      #vamos a recorrer todos los elementos de la tabla de frecuencia, si este valor es existente construimos un arreglo con la fila y lo arreglamos para que sea concistente en la comparacion del if
  for( i in 1: nrow(tabla))
  {
    
     if(tabla[i,5]!=0) 
     {
       lll<-tabla[i,]
       lll
       llll<-lll[,1]
       llll
       
       sentenceString <- toString(llll)
       searchString <- ' '
       replacementString <- ''
       sentenceString = sub(searchString,replacementString,sentenceString)
       sentenceString
       
       
        for(j in 1: 336){
          w <- dataset2006[[6]] %>% attr('labels')
           ww<-names(w[j])
           vv<-tolower(ww)
          if(sentenceString==vv){
            lll <- cbind(lll,w[[j]])
            lll <- cbind(lll,"2006")
            
          }
        }
       ppp <-rbind(ppp,lll)
   }
    
  }
   
```
```{r}
ppp 

```

```{r}
d <-tabla[!(tabla$Freq == 0),]
d
llll<-d[,1]
llll

nrow(d)
```

```{r}

dataset2006 <- read_sav('casen2006.sav')


```

```{r}
d <-tabla[!(tabla$Freq == 0),]
# d
# llll<-d[,1]
# llll
datallll <- data.frame()
nrow(d)
 for(i in 1: nrow(d)){
   llll_fila <- d[i,]
    llll<-d[i,1]
    sentenceString <- toString(llll)
            searchString <- ' '
            replacementString <- ''
            sentenceString = sub(searchString,replacementString,sentenceString)
            sentenceString
    #print(sentenceString)
             w <- dataset2006[[6]] %>% attr('labels')
             for(j in 1: 336){
               
               
               ww<-names(w[j])
              vv<-tolower(ww)
              
               if(sentenceString==vv){
                llll_fila <- cbind(llll_fila,w[[j]])
                llll_fila <- cbind(llll_fila,"2006")
                
              }
            
                
                
            
             }
             datallll <-rbind(datallll,llll_fila)
             
 }

```

```{r}
 datallll
```

```{r}
d <-tabla[!(tabla$Freq == 0),]
        for(i in 1: nrow(d)){
          llll<-d[i,1]
            sentenceString <- toString(llll)
            searchString <- ' '
            replacementString <- ''
            sentenceString = sub(searchString,replacementString,sentenceString)
            sentenceString
            
            for(j in 1: 336){
              #w <- dataset06[[6]] %>% attr('labels')
              ww<-names(w[j])
              vv<-tolower(ww)
              if(sentenceString==vv){
                llll <- cbind(llll,w[[j]])
                llll <- cbind(llll,"2006")
                
              }
            
        }
           ppp <-rbind(ppp,llll)
        }
            ppp 
            
         
```

