---
title: "exc_prec"
author: "Victor"
date: "26 de noviembre de 2020"
output: html_document
---
```{r}
library(ggplot2)
library(ggpubr)
library(markdown)
library(shiny)
library(shinythemes)
library(tidyverse)
library(magrittr)
library(lubridate)
library(plotly)
library(xts)
library(dygraphs)
library(kableExtra)
library(knitr)
library("readxl")
library(rsconnect)
library(dplyr)
library(summarytools)
library(epiDisplay)
#library(leaflet)
library(haven)
library(epiDisplay)
library("readxl")
library(expss)
library(hrbrthemes)
library(viridis)
library(viridisLite)
library(DescTools)
library(roperators)
library(shinycssloaders)
library(writexl)
library(labelled)
library(tidyverse)
library(haven)
library(readr)
library(sjmisc)
library(WriteXLS)
oldw <- getOption("warn")
options(warn = -1)
```

```{r}
dataset2006 <- read_sav('casen2006.sav')
```

```{r}
w <- dataset2006[[6]] %>% attr('labels')
head(w,4)
#### Aqui se obtienen los nombres de las comunas
a <- names(w) 
head(a,4)
b<-w[[4]]
b
# head(a,5)
```



```{r}
dataset06 <- read.csv('mydata2006_sub.csv')

        a <- dataset06$comuna
        b <- dataset06$t4
        c <- dataset06$e1
        d <- dataset06$sexo
        cross_tab= table(a, b, c, d)
        cross_tab
    
```

```{r}
tabla <- as.data.frame(cross_tab)
#head(tabla,10)
tabla
```

```{r}
ppp <- data_frame()

      
      #vamos a recorrer todos los elementos de la tabla de frecuencia, si este valor es existente construimos un arreglo con la fila y lo arreglamos para que sea concistente en la comparacion del if
  for( i in 1: nrow(tabla))
  {
    
     if(tabla[i,5]!=0) 
     {
       lll<-tabla[i,]
       lll
       llll<-lll[,1]
       llll
       
       sentenceString <- toString(llll)
       searchString <- ' '
       replacementString <- ''
       sentenceString = sub(searchString,replacementString,sentenceString)
       sentenceString
       
       
        for(j in 1: 300){
          w <- dataset2006[[6]] %>% attr('labels')
           ww<-names(w[j])
           vv<-tolower(ww)
          if(sentenceString==vv){
            lll <- cbind(lll,w[[j]])
            lll <- cbind(lll,"2006")
            
          }
        }
       ppp <-rbind(ppp,lll)
   }
    
  }
   
```
```{r}
ppp 

options(warn = oldw)
```